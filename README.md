## Project: Automated Task and Test Case Generation with Gemini API and Jira Integration

This project demonstrates an end-to-end automation pipeline implemented in a single Python script, `jira-autonomous.py`. A manager assigns a high-level development requirement, and two AI-driven agents (powered by the Gemini API) handle:

1. **Requirement Agent**: Analyzes the requirement, generates 3–5 high-level development subtasks using `generate_development_tasks()`, and creates corresponding Jira tickets via `create_jira_ticket()`.
2. **Test Agent**: For each development subtask, generates 3–5 comprehensive test cases using `generate_and_create_test_cases()`, and adds them as Jira subtasks via `create_jira_subtask()`.

Automating subtask and test case creation accelerates sprint planning, ensures consistency, and reduces manual overhead.

## File Structure

* Contains all functionality:

  * Manager input handling
  * Requirement agent prompt construction and AI calls via `generate_content_with_fallback()`
  * Test agent prompt construction and AI calls via `generate_content_with_fallback()`
  * JSON parsing of AI responses within `generate_development_tasks()` and `generate_and_create_test_cases()`
  * Jira API integration for creating tickets (`create_jira_ticket()`) and subtasks (`create_jira_subtask()`)
  * Utility functions for logging, error handling, key rotation, and issue linking

## Dependencies

* Python 3.9+
* `requests` for HTTP calls
* `json` for parsing AI responses
* `time` for delay management
* `google.generativeai` (`genai`) as Gemini API client
* `python-dotenv` for environment variable loading

## Setup Instructions

1. **Configure Environment Variables**:

   * Create a `.env` file in the project root with the following keys:

     ```bash
     JIRA_EMAIL=your-email@example.com
     JIRA_API_TOKEN=your-jira-api-token
     JIRA_BASE_URL=https://your-domain.atlassian.net
     GEMINI_API_KEY1=your-first-gemini-key
     GEMINI_API_KEY2=your-second-gemini-key
     ```

2. **Install Dependencies**:

   ```bash
   pip install requests google-generativeai python-dotenv
   ```

3. **Verify Project Key**:

   * On your Jira board, note your project key (e.g., `CPG`). Update the `PROJECT_KEY` constant in the script if needed.

4. **(Optional) Update Assignee Account ID**:

   * In `create_jira_ticket()` and `create_jira_subtask()`, replace `assignee` ID with your Jira `accountId` if the default placeholder needs updating.

## Usage

1. **Run the script with a main requirement**:

   ```bash
   python jira-autonomous.py
   ```

   * Enter the requirement when prompted.

2. **Review Tickets**:

   * A parent ticket is created using `create_jira_ticket()`.
   * Development subtasks are generated by `generate_development_tasks()` and created via `create_jira_ticket()` linked to the parent.
   * Test cases are generated by `generate_and_create_test_cases()` and created via `create_jira_subtask()` under each development subtask.

3. **Fetch and Display**:

   * Finally, `fetch_visible_tickets()` retrieves and prints all visible tickets (excluding sample tickets).

## Core Functions

* `generate_content_with_fallback(prompt: str) -> str`:

  * Invokes Gemini API calls with key rotation and retry logic.

* `generate_development_tasks(requirement: str) -> list`:

  * Constructs a prompt to generate 3–5 subtasks.
  * Parses JSON response into a list of task objects.

* `create_jira_ticket(summary: str, description: str) -> str`:

  * Creates a Jira Task and returns the issue key.

* `create_jira_subtask(parent_key: str, summary: str, description: str) -> str`:

  * Creates a Jira Subtask under the given parent issue.

* `fetch_visible_tickets() -> list`:

  * Retrieves existing project tickets (excluding sample ones) via Jira Search API.

* `get_link_types() -> list`:

  * Fetches available Jira issue link types.

* `link_issues(outward_issue: str, inward_issue: str, link_type: str = "Relates") -> bool`:

  * Links two Jira issues with the specified relationship.

* `create_linked_subtasks(parent_key: str, subtasks: list) -> (list, dict)`:

  * Creates Jira tickets for each generated subtask and links them to the parent.

* `generate_and_create_test_cases(task_description: str, task_key: str) -> list`:

  * Generates 3–5 test cases, parses JSON, and creates them as Jira subtasks.

## Error Handling

* JSON parsing within generators logs raw output on failure.
* Jira API calls retry up to 3 times before logging errors.
* Gemini API key fallback handles rate limits and quota issues.

## Extensibility

* Add more AI agents (e.g., for documentation or deployment) by creating new prompt functions.
* Customize prompts in `generate_development_tasks()` and `generate_and_create_test_cases()` to adjust output format.
* Integrate additional Jira interactions (e.g., transitions, comments) by adding new helper functions.
